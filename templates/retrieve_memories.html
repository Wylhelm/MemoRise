{% extends "base.html" %}

{% block content %}
<h1>Retrieve Memories</h1>
<form method="POST" class="mb-4">
    <div class="form-row">
        <div class="form-group col-md-4">
            <label for="keyword">Keyword:</label>
            <input type="text" class="form-control" id="keyword" name="keyword">
        </div>
        <div class="form-group col-md-4">
            <label for="category">Category:</label>
            <input type="text" class="form-control" id="category" name="category">
        </div>
        <div class="form-group col-md-4">
            <label for="sentiment">Sentiment:</label>
            <select class="form-control" id="sentiment" name="sentiment">
                <option value="">All</option>
                <option value="positive">Positive</option>
                <option value="neutral">Neutral</option>
                <option value="negative">Negative</option>
            </select>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group col-md-4">
            <label for="start_date">Start Date:</label>
            <input type="date" class="form-control" id="start_date" name="start_date">
        </div>
        <div class="form-group col-md-4">
            <label for="end_date">End Date:</label>
            <input type="date" class="form-control" id="end_date" name="end_date">
        </div>
        <div class="form-group col-md-4">
            <label for="language">Language:</label>
            <input type="text" class="form-control" id="language" name="language">
        </div>
    </div>
    <button type="submit" class="btn btn-primary">Search</button>
</form>

{% if memories %}
    {% for memory in memories %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Memory ID: {{ memory[0] }}</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{ memory[2] }}</h6>
                <p class="card-text">{{ memory[1] }}</p>
                <p><strong>Category:</strong> {{ memory[3] }}</p>
                <p><strong>Sentiment:</strong> {{ memory[4] }}</p>
                <p><strong>Language:</strong> {{ memory[8] }} ({{ memory[9] }})</p>
                <p><strong>Key Phrases:</strong> {{ ', '.join(memory[7] | from_json) }}</p>
                <p><strong>Entities:</strong> {{ ', '.join([f'{e[0]} ({e[1]})' for e in memory[6] | from_json]) }}</p>
                <a href="{{ url_for('update_memory_route', memory_id=memory[0]) }}" class="btn btn-primary btn-sm">Edit</a>
                <form action="{{ url_for('delete_memory_route', memory_id=memory[0]) }}" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this memory?')">Delete</button>
                </form>
            </div>
        </div>
    {% endfor %}
{% else %}
    <p>No memories found.</p>
{% endif %}
{% endblock %}
